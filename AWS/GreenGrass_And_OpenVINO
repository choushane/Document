AWS GreenGrass and OpenVINO Docker Image Create

Download : greengrass-linux-x86-64-1.7.0.tar.gz
(https://docs.aws.amazon.com/zh_tw/greengrass/latest/developerguide/what-is-gg.html#gg-core-download-tab)

docker build --build-arg "greengrass_release=greengrass-linux-x86-64-1.7.0.tar.gz" .

Dockerfile:
Dockerfile-x86-v1.7.0-nodejs-v10-ubuntu

FROM ubuntu:16.04
ENV QNAP_QPKG=Greengrass
ARG greengrass_release
ENV GREENGRASS_RELEASE=${greengrass_release}
RUN apt-get -y update && useradd ggc_user && groupadd ggc_group && apt-get -y install supervisor sqlite3 wget curl libc6-dev build-essential python2.7 libpython2.7 ocl-icd-opencl-dev lsb-release sudo cpio vim && wget https://bootstrap.pypa.io/get-pip.py && python get-pip.py && rm get-pip.py && apt-get -y install --reinstall procps && curl -sL https://deb.nodesource.com/setup_10.x | bash - && apt-get -y install -y nodejs && rm -rf /var/lib/apt/lists/* && pip install opencv-python
COPY supervisord.conf /etc/supervisor/supervisord.conf 
COPY sysctl.conf /etc/sysctl.conf

RUN mkdir -p /dest/Source/ /dest/Result
RUN mkdir /local_src/
RUN chmod 0775 /local_src/
RUN chmod -R 0775 /dest

RUN echo '# AWS Greengrass' >> /etc/sysctl.conf
RUN echo 'fs.protected_hardlinks = 1' >> /etc/sysctl.conf
RUN echo 'fs.protected_symlinks = 1' >> /etc/sysctl.conf

# Copy/Untar Greengrass RC inside Docker Image
COPY $greengrass_release /
RUN tar xzf /$GREENGRASS_RELEASE -C /
RUN rm /$GREENGRASS_RELEASE
RUN apt-get -y remove curl
#ENTRYPOINT ["supervisord","-c","/etc/supervisor/supervisord.conf"]


Install dependencies and Intel® OpenVINO™, skip Missing optional prerequisites

tar xvf l_openvino_toolkit_p_2018.5.455.tgz -C /tmp
---
apt-get update && \
apt-get install -y lsb-release sudo cpio vim
yum install -y redhat-lsb-core
---
cd /tmp/l_openvino_toolkit_p_2018.5.455
./install_cv_sdk_dependencies.sh
./install.sh

安裝以下套件
Options > Component selection
--------------------------------------------------------------------------------
Select components you wish to modify. When you have completed your changes,
select option 1 to continue.
--------------------------------------------------------------------------------

   1. Accept and continue [ default ]
   2. [x] Inference Engine (already installed)
   3. [x] Model Optimizer (already installed)
   4. [x] OpenCV*
   5. [x] OpenVX*
   6. [ ] Models
   7. [x] Algorithms
   8. [x] Intel(R) Media SDK (already installed)

   Install space required:  770MB

Set environment variables and build the sample code
source /opt/intel/computer_vision_sdk/bin/setupvars.sh
cd /opt/intel/computer_vision_sdk/deployment_tools/inference_engine/samples
build_samples.sh

Reduce image size :

apt-get purge libx11.* libqt.* //移除 ubuntu-x11
apt-get purge dpkg -l | grep ^rc | awk '{ print $2 }'
apt-get autoremove
刪除 *.a files
find / -name *.a
rm /opt/intel/computer_vision_sdk_2018.5.455/openvx/samples/
rm -rf /opt/intel/computer_vision_sdk_2018.5.455/deployment_tools/inferen ce_engine/lib/ubuntu_18.04/
rm -rf /opt/intel/computer_vision_sdk_2018.5.455/deployment_tools/inference_engine/lib/centos_7.4/
apt-get install libgtk2.0-0
